# Status-Ming 设计文档

**项目名称**: Status-Ming
**作者**: lgnorant-lu
**最后更新**: 2025-05-12
**核心技术**: PySide6

## 1. 项目概述与目标

Status-Ming 是一个以猫咪为主题的交互式桌面宠物应用，旨在通过桌宠的视觉状态反馈计算机的核心性能指标。本项目基于PySide6进行UI和核心交互开发。

**当前阶段目标 (MVP - Minimum Viable Product):**
- 实现一个可显示、可拖动的桌宠（使用猫咪占位符图像/动画）。
- 桌宠能够根据核心系统参数（CPU、内存等）改变其状态和动画。
- 提供一个简约的、按需显示的数字化面板，展示具体的系统参数。
- 用户可以通过简单的交互（如右键菜单）关闭应用。

**长期愿景 (Post-MVP):**
- 集成真实的、高质量的猫咪像素动画。
- 丰富桌宠行为与交互，增强个性化和智能化。
- 实现模块化的快捷功能（如快速启动、笔记等）。
- 探索LLM（大型语言模型）集成，赋予桌宠更高级的交互能力。
- 持续优化性能和用户体验。

## 2. MVP 系统架构设计

### 2.1. 核心模块

MVP阶段主要包含以下核心模块：

1.  **`PetWindow` (UI层 - PySide6)**:
    *   **职责**: 作为桌宠应用的主窗口。实现无边框、可设置透明背景、响应鼠标拖拽移动。承载桌宠的渲染区域和可能的交互元素。
    *   **主要交互**: 接收用户输入（拖拽、点击），分发给 `InteractionHandler`。

2.  **`Renderer` (渲染模块 - PySide6集成)**:
    *   **职责**: 负责在 `PetWindow` 上绘制所有视觉内容，包括桌宠的占位符动画帧、以及 `StatsPanel`。
    *   **技术**: 利用PySide6的 `QPainter` API进行高效绘制。管理动画帧的切换和播放。

3.  **`Resources` (资源管理器)**:
    *   **职责**: 加载、管理和提供应用所需的资源，MVP阶段主要是占位符图像 (如PNG序列帧图)。
    *   **交互**: 被 `Renderer` 调用以获取图像数据。

4.  **`SystemMonitor` (系统监控模块)**:
    *   **职责**: 独立、定期地获取关键系统性能参数，如CPU使用率、内存使用率。未来可扩展至GPU、磁盘、网络等。
    *   **技术**: 主要使用 `psutil`库，按需考虑 `GPUtil` 等。
    *   **交互**: 向 `BehaviorLogic` 和 `StatsPanel` 提供数据。

5.  **`BehaviorLogic` (行为逻辑模块)**:
    *   **职责**: 核心决策模块。根据从 `SystemMonitor` 获取的系统数据，决定桌宠当前的逻辑状态（例如 `IDLE`, `ACTIVE_LOW`, `ACTIVE_MEDIUM`, `ACTIVE_HIGH` 等）。
    *   **交互**: 将状态变更通知给 `Renderer`，以便切换到对应的动画。

6.  **`InteractionHandler` (交互处理模块)**:
    *   **职责**: 处理来自 `PetWindow` 的用户输入事件（如鼠标右键点击），并执行相应操作（如显示上下文菜单、触发退出应用等）。
    *   **交互**: 与PySide6的事件系统集成。

7.  **`StatsPanel` (UI层 - PySide6, 可选)**:
    *   **职责**: 一个简约的UI面板，用于显示 `SystemMonitor` 提供的具体系统参数数值。
    *   **特性**: MVP阶段可以设计为按需显示/隐藏（例如通过快捷键或鼠标悬停在特定区域）。可以集成到 `PetWindow` 内或作为独立的浮动小部件。

### 2.2. MVP核心交互流程

1.  **初始化**:
    *   应用启动，`PetWindow` 创建并显示。
    *   `SystemMonitor` 开始定期轮询系统参数。
    *   `Renderer` 加载初始的占位符桌宠图像（如IDLE状态）。

2.  **运行时循环**:
    *   `SystemMonitor` 获取最新的系统数据。
    *   `BehaviorLogic` 分析数据，判断是否需要改变桌宠状态。
    *   如果状态改变，`BehaviorLogic` 通知 `Renderer`。
    *   `Renderer` 从 `Resources` 获取新状态对应的动画帧（占位符），并在 `PetWindow` 上更新绘制。
    *   `PetWindow` 持续监听用户输入，交由 `InteractionHandler` 处理。
    *   如果 `StatsPanel` 可见，它会从 `SystemMonitor` 获取数据并更新显示。

3.  **用户交互 (示例：退出)**:
    *   用户在 `PetWindow` 上右键点击。
    *   `InteractionHandler` 捕获事件，显示包含"退出"选项的上下文菜单。
    *   用户选择"退出"，`InteractionHandler` 执行应用关闭逻辑。

*[图表占位: MVP核心模块交互图，待后续使用Graphviz在 `Diagrams/Architecture/mvp_architecture.py` 中创建]*

## 3. 技术选型 (MVP及后续规划)

-   **UI框架**: **PySide6** (Qt for Python) - 核心选择，负责所有GUI元素的创建、事件处理和渲染集成。
-   **系统信息获取**:
    -   `psutil`: 用于获取CPU、内存、磁盘I/O、网络I/O等跨平台系统信息。
    -   `GPUtil` (可选): 用于获取NVIDIA GPU的温度和使用率，按需集成。
-   **图像处理 (占位符阶段)**: PySide6 内建的 `QPixmap`, `QImage` 处理。若后续有复杂精灵图操作，可能考虑 `Pillow`。
-   **配置文件**: 简单配置可使用JSON格式 (`config.json`)。若配置复杂化，可考虑 `configparser` 或 YAML。
-   **数据持久化 (远期 - 桌宠记忆等)**: SQLite - 轻量级，适合桌面应用。
-   **测试框架**: Pytest - 配合 `pytest-qt` 进行PySide6 UI测试。
-   **打包与分发**: PyInstaller / cx_Freeze / Briefcase (待选型和测试)。

## 4. 占位符资源策略

-   MVP阶段，所有桌宠动画和应用图标将使用简单的占位符图像/序列帧图。
-   这些资源将存放于 `assets/placeholders/` 目录。
-   目的是快速验证核心功能逻辑，避免因美术资源制作瓶颈阻塞开发进度。
-   占位符应易于被真实美术资源替换。

## 5. 长远架构考量 (初步)

-   **模块化与插件化**: 核心系统设计时，应考虑接口的通用性和可扩展性，便于未来添加新的快捷功能、行为模式或集成外部服务（如LLM）作为独立模块或插件。
-   **事件驱动**: 可以考虑引入更明确的内部事件总线机制（如基于`signal`库或自定义实现），以解耦模块间的直接依赖，特别是对于复杂的行为触发和UI更新。
-   **配置分离**: 将用户可配置的参数（如监控刷新率、桌宠行为阈值、UI主题色等）外部化到配置文件中。

## 6. 设计决策与理由 (部分)

-   **选择PySide6**: Qt框架功能完善，跨平台性好，社区成熟。PySide6作为官方绑定，与Python结合紧密。
-   **MVP聚焦核心监控反馈**: 确保项目在初期有一个清晰、可达成的目标，快速验证核心价值。
-   **占位符先行**: 降低初期美术门槛，使开发可以并行。

---
*本文档将随着项目进展和设计细化持续更新。* 