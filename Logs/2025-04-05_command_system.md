# 交互命令系统

## 模块说明
交互命令系统是一个允许用户通过各种方式与系统交互的框架。它提供了一种统一的方法来处理用户输入的命令，无论这些命令来自于文本输入、手势、热键还是菜单选择。命令系统的设计目标是提供一种灵活、可扩展的方式来实现用户与应用程序的交互。

## 主要组件

### 命令模型 (Command)
- **职责**：定义命令的结构和执行流程
- **功能**：
  - 封装命令的名称、描述、类型和参数定义
  - 维护命令的执行回调函数
  - 提供命令执行的标准接口
  - 支持命令参数的验证和类型转换
  - 生成命令的帮助和用法信息
- **技术特点**：
  - 采用回调函数模式，允许灵活定义命令行为
  - 支持命令分组，便于组织和管理
  - 内置参数验证机制，确保参数有效性
  - 命令执行状态跟踪，便于监控和调试

### 命令注册中心 (CommandRegistry)
- **职责**：管理命令的注册和查找
- **功能**：
  - 提供命令的注册和注销接口
  - 通过名称或别名查找命令
  - 管理命令的分组
  - 支持命令别名管理
- **技术特点**：
  - 使用字典数据结构高效存储和查找命令
  - 支持命令别名解析，增强用户体验
  - 命令分组管理，便于组织和展示
  - 提供命令计数等统计信息

### 命令解析器 (CommandParser)
- **职责**：解析用户输入的命令文本
- **功能**：
  - 识别命令文本并提取命令名称
  - 解析命令参数，支持多种参数格式
  - 转换参数类型，确保类型匹配
  - 创建命令执行上下文
- **技术特点**：
  - 使用正则表达式进行高效解析
  - 支持位置参数和命名参数
  - 丰富的参数类型转换功能
  - 可配置的命令前缀和注释前缀

### 命令管理器 (CommandManager)
- **职责**：协调命令系统的各个组件
- **功能**：
  - 初始化和管理命令系统
  - 处理命令执行请求
  - 管理命令历史记录
  - 提供系统命令（如帮助、历史、别名管理等）
  - 与事件系统集成，响应命令事件
- **技术特点**：
  - 单例模式，确保全局唯一实例
  - 线程安全设计，支持并发操作
  - 集成事件系统，支持事件驱动的命令执行
  - 提供命令历史管理和查询功能

## 主要功能
1. **命令执行**：执行用户通过各种方式触发的命令
2. **命令别名**：支持为命令创建易记的别名
3. **命令分组**：按功能、模块等对命令进行分组
4. **参数解析**：解析并校验命令参数
5. **帮助系统**：提供命令使用帮助和用法说明
6. **历史记录**：记录和查询命令执行历史
7. **事件集成**：与事件系统无缝集成，支持多种触发方式
8. **类型转换**：自动进行参数类型转换，确保类型匹配

## 技术细节

### 命令编写最佳实践
- 命令名应简短、描述性，使用小写字母
- 提供清晰的命令描述和参数说明
- 定义合适的命令类型和分组
- 命令回调函数应专注于单一职责
- 对于复杂命令，考虑拆分为多个子命令

### 命令参数格式
- 支持位置参数：`/command value1 value2`
- 支持命名参数：`/command --param1 value1 --param2 value2`
- 支持短格式参数：`/command -p value`
- 支持布尔标志：`/command --flag`
- 支持参数值引号：`/command "value with spaces"`
- 支持等号语法：`/command --param=value`

### 命令前缀
- 默认使用`/`作为命令前缀
- 支持自定义前缀，如`!`、`#`、`$`等
- 支持设置注释前缀，默认为`#`

### 命令类型
- **系统命令**：核心系统功能，如帮助、历史等
- **动作命令**：执行特定操作的命令
- **查询命令**：获取信息的命令
- **配置命令**：更改系统设置的命令
- **自定义命令**：用户定义的命令

## 未来规划
1. **命令脚本支持**：支持执行包含多个命令的脚本文件
2. **更多触发方式**：支持更多命令触发方式，如语音命令、手势命令等
3. **命令历史增强**：支持历史命令搜索、过滤和重新执行
4. **上下文感知命令**：根据当前状态提供相关命令建议
5. **权限控制**：基于角色的命令访问控制
6. **命令组合**：支持命令管道和组合操作
7. **自动补全**：命令和参数的智能自动补全

## 变更记录
- 2025/04/05: 初始版本实现，完成命令模型、注册中心、解析器和管理器
- 2025/04/05: 完成系统命令（help、commands、history、alias）
- 2025/04/05: 与交互事件系统集成，支持菜单命令和事件触发命令 